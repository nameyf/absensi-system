<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“… æ‰“å¡æ—¥å†ç»Ÿè®¡</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; padding: 20px; }
    label { display: block; margin: 10px 0 5px; }
    input { padding: 5px; }
    .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin-top: 15px; }
    .calendar div { border: 1px solid #ccc; min-height: 60px; font-size: 12px; padding: 4px; white-space: pre-wrap; }
    .calendar .header { background: #f0f0f0; font-weight: bold; }
    .green { background: #d4edda; }    /* æ­£å¸¸ */
    .yellow { background: #fff3cd; }   /* å¼‚å¸¸ */
    .red { background: #f8d7da; }      /* ç¼ºå¡ */
  </style>
</head>
<body>
  <h2>ğŸ“Š æ‰“å¡æ—¥å†ç»Ÿè®¡ Kalender Kehadiran</h2>
  <label>è´¦å· / Akun:</label>
  <input type="text" id="username">
  <label>é€‰æ‹©æœˆä»½ / Pilih Bulan:</label>
  <input type="month" id="monthPicker">
  <button onclick="render()">ğŸ“¥ åŠ è½½æˆ‘çš„æ‰“å¡ç»Ÿè®¡</button>
  <div class="calendar" id="calendar"></div>

  <script>
    const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3Na1TFEHoAXsdgKBr6s4eBSFCRHtlMv14UXoO6hD2gxybZpXNAaG0IOw1W0GX5J_cmq0Mnu3J-K77/pub?gid=0&single=true&output=csv";

    function render() {
      const ym = document.getElementById("monthPicker").value;
      const user = document.getElementById("username").value.trim();
      if (!ym || !user) return alert("è¯·å¡«å†™è´¦å·å’Œæœˆä»½ / Harap isi akun dan bulan");

      fetch(SHEET_CSV_URL)
        .then(res => res.text())
        .then(csv => {
          const rows = csv.trim().split("\n").map(r => r.split(","));
          const data = {};
          for (let i = 1; i < rows.length; i++) {
            const [date, name, type,, , , , status] = rows[i];
            if (!date.startsWith(ym) || name.trim() !== user) continue;
            const day = date.split("-")[2];
            if (!data[day]) data[day] = { in: null, out: null };
            if (type.includes("ä¸Šç­")) data[day].in = status || "";
            if (type.includes("ä¸‹ç­")) data[day].out = status || "";
          }
          drawCalendar(ym, data);
        });
    }

    function drawCalendar(ym, map) {
      const [y, m] = ym.split("-").map(Number);
      const firstDay = new Date(y, m - 1, 1).getDay();
      const days = new Date(y, m, 0).getDate();
      const cal = document.getElementById("calendar");
      cal.innerHTML = "";
      ["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"].forEach(d => {
        const cell = document.createElement("div");
        cell.textContent = d;
        cell.className = "header";
        cal.appendChild(cell);
      });
      for (let i = 0; i < firstDay; i++) cal.appendChild(document.createElement("div"));
      for (let d = 1; d <= days; d++) {
        const dayStr = String(d).padStart(2, "0");
        const info = map[dayStr];
        const div = document.createElement("div");
        let className = "red";
        if (info) {
          const inOK = info.in && info.in.includes("æ­£å¸¸");
          const outOK = info.out && info.out.includes("æ­£å¸¸");
          const inLate = info.in && (info.in.includes("è¿Ÿåˆ°") || info.in.includes("å¼‚å¸¸"));
          const outEarly = info.out && (info.out.includes("æ—©é€€") || info.out.includes("å¼‚å¸¸"));
          if (inOK && outOK) className = "green";
          else if (inLate || outEarly) className = "yellow";
        }
        div.className = className;
        div.textContent = `${d}`;
        cal.appendChild(div);
      }
    }

    // é»˜è®¤è®¾ç½®ä¸ºæœ¬æœˆ
    const now = new Date();
    const ym = now.toISOString().slice(0, 7);
    document.getElementById("monthPicker").value = ym;
  </script>
</body>
</html>
